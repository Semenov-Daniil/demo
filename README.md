# Цифровая платформа для выполнения работ по компетенции «Веб-технологии»

## О проекте

Цифровая платформа разработана для локального управления чемпионатами и демонстрационными экзаменами по компетенции «Веб-технологии» в образовательных учреждениях. Она обеспечивает автономное развертывание, изолированные рабочие среды для студентов, управление событиями, участниками и файлами, а также высокий уровень безопасности и гибкости.

### Основные возможности
- **Для экспертов**:
  - Управление экспертами, событиями, студентами, модулями и файлами.
  - Создание и настройка чемпионатов и экзаменов.
  - Экспорт данных студентов в формате .docx.
- **Для студентов**:
  - Доступ к личному кабинету с индивидуальной рабочей областью.
  - Подключение через SSH или сетевой диск (Samba).
  - Работа с виртуальными хостами и базами данных через phpMyAdmin.
  - Просмотр и скачивание файлов событий.

### Основной стек технологий
#### Технологии проекта
- Backend: **PHP** (фреймворк **Yii2**, шаблон Advanced).
- Frontend: **HTML, CSS, JavaScript** (бибилотеки **Bootstrap5** и **jQuery**)

#### Технологии окружения
- **Apache2**: Веб-сервер с модулями `php`, `mpm_itk_module`, `headers_module`, `rewrite_module`.
- **MySQL**: СУБД для хранения данных.
- **OpenSSH**: Для безопасного подключения к рабочим областям.
- **Samba**: Для монтирования рабочих директорий как сетевых дисков.
- **Redis**: Для хранения сессий и работы с очередями.
- **phpMyAdmin**: Для управления базами данных.
- **Composer**: Для управления зависимостями PHP.

## Требования

- **Операционная система**: Ubuntu Server 24.04 (рекомендуется) или другой Linux-дистрибутив, совместимый с необходимыми пакетами. Проект разрабатывался с использованием виртуальной машины VMware, но может быть развёрнут на физическом сервере или хостинге.
- **Программное обеспечение**:
  - Apache2 (с модулями `php`, `mpm_itk_module`, `headers_module`, `rewrite_module`).
  - PHP ≥ 7 (с модулями `pdo_mysql`, `mbstring`, `intl`, `redis`).
  - MySQL или совместимая СУБД.
  - Composer (для управления зависимостями).
- **Аппаратное обеспечение**:
  - Минимум 4 ГБ оперативной памяти и 20 ГБ дискового пространства.

## Безопасность

- **Изоляция окружений**: Студенты работают в изолированных chroot-окружениях, ограничивающих доступ к файловой системе сервера.
- **RBAC**: Ролевое управление доступом (Role-Based Access Control) обеспечивает строгое разграничение прав между экспертами и студентами.
- **Шифрование паролей**: Пароли хранятся в зашифрованном виде, с возможностью просмотра в читаемом формате через таблицу `encrypted_passwords`.
- **Локальная сеть**: Платформа работает в изолированной локальной сети, минимизируя риски внешних атак.
- **Контроль доступа**: Доступ к виртуальным хостам, базам данных и файлам ограничен правами пользователя.

## Установка

### 1. Подготовка окружения
Проект разрабатывался на Ubuntu Server 24.04 с использованием следующего стека программного обеспечения:
- Apache2 (с модулями `php`, `mpm_itk_module`, `headers_module`, `rewrite_module`)
- PHP (с модулями `pdo_mysql`, `mbstring`, `intl`, `redis`)
- MySQL
- OpenSSH
- Samba
- Redis
- phpMyAdmin
- Composer

Установите необходимые пакеты:
```bash
sudo apt update
sudo apt install apache2 libapache2-mpm-itk libapache2-mod-php php php-mysql php-mbstring php-intl php-redis mysql-server openssh-server samba samba-common-bin redis-server phpmyadmin composer
```

Включите модули Apache:

```bash
sudo a2enmod mpm_itk headers rewrite
sudo systemctl restart apache2
```

### 2. Настройка проекта

**Требования к проекту**:

- PHP ≥ 7 (с модулями `pdo_mysql`, `mbstring`, `intl`, `redis`).
- MySQL.
- Composer.

1. Склонируйте репозиторий или скопируйте проект в директорию `/var/www/project`.

2. Убедитесь, что все файлы и директории принадлежат пользователю `www-data`:

   ```bash
   sudo chown -R www-data:www-data /var/www/project
   ```

3. Настройте права для выполнения bash-скриптов пользователем `www-data`:

   ```bash
   echo "www-data ALL=(ALL) NOPASSWD: /var/www/project/bash/*.sh" | sudo tee -a /etc/sudoers.d/www-data
   echo "www-data ALL=(ALL) NOPASSWD: /var/www/project/bash/**/*.sh" | sudo tee -a /etc/sudoers.d/www-data
   sudo chmod 440 /etc/sudoers.d/www-data
   ```

4. Скопируйте файл `env.example` в `.env` и настройте параметры:

   ```bash
   cp env.example .env
   ```

   В `.env` укажите:

   - Секретные ключи (не меняйте после начальной настройки, иначе пароли студентов и экспертов станут недоступны в читаемом виде).
   - Логин и пароль супер-эксперта.
   - Пользователь и группа сайта
   - Суффикс к виртуальным хостам (не меняйте после начальной настройки, иначе возникунт проблемы с управлением и удалением уже созданых виртуальных хостов студентов).

5. Создайте базу данных MySQL и пользователя:

   ```sql
   CREATE DATABASE platform_db;
   CREATE USER 'platform_user'@'localhost' IDENTIFIED BY 'secure_password';
   GRANT ALL PRIVILEGES ON platform_db.* TO 'platform_user'@'localhost';
   FLUSH PRIVILEGES;
   ```

6. Настройте подключение к базе данных в `common/config/main-local.php`:

   ```php
   'components' => [
       'db' => [
           'class' => 'yii\db\Connection',
           'dsn' => 'mysql:host=localhost;dbname=platform_db',
           'username' => 'platform_user',
           'password' => 'secure_password',
           'charset' => 'utf8',
       ],
   ],
   ```

### 3. Инициализация проекта

1. Установите зависимости через Composer:

   ```bash
   composer update
   ```

2. Инициализируйте проект:

   ```bash
   php init
   ```

   Выберите режим (prod или dev).

3. Примените миграции базы данных:

   ```bash
   php yii migrate
   ```

### 4. Настройка сервера

Настройте виртуальный хост Apache для основного домена (`http://domain`). Пример конфигурации:

```apache
<VirtualHost *:80>
    ServerName domain
    DocumentRoot /var/www/project
    <Directory /var/www/project>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

1. Сохраните конфигурацию в `/etc/apache2/sites-available/platform.conf`.

2. Активируйте виртуальный хост:

   ```bash
   sudo a2ensite platform.conf
   sudo systemctl reload apache2
   ```

3. Убедитесь, что все файлы и директории принадлежат пользователю `www-data`:

   ```bash
   sudo chown -R www-data:www-data /var/www/project
   ```

### 5. Проверка

- Перейдите на `http://domain/login` для авторизации студентов.
- Перейдите на `http://domain/expert/login` для авторизации экспертов.
- Убедитесь, что сервисы SSH, Samba, Redis и phpMyAdmin работают корректно.

## Первоначальное использование

1. **Настройка супер-эксперта**:

   - В файле `.env` обязательно измените логин и пароль супер-эксперта:

     ```env
     SUPER_EXPERT_LOGIN=admin
     SUPER_EXPERT_PASSWORD=secure_password
     ```

Установите `ENCRYPTION_KEY` и не меняйте его после начальной настройки, чтобы избежать потери читаемых паролей студентов и экспертов:

```env
ENCRYPTION_KEY=your_secure_encryption_key
```

1. Авторизуйтесь как супер-эксперт на `http://domain/expert/login`.

2. Добавьте новых экспертов.

3. Платформа готова к использованию!

## Использование

### Для студентов

1. Перейдите на `http://domain/login` и войдите, используя предоставленные логин и пароль.
2. В личном кабинете вы можете:
   - Скопировать команды для подключения по SSH или сетевого диска.
   - Перейти к базе данных через phpMyAdmin.
   - Скачать файлы события.
   - Перейти к виртуальным хостам модулей.
3. Для выхода нажмите «Выход» в меню пользователя.

### Для экспертов

1. Перейдите на `http://domain/expert/login` и войдите с логином и паролем.
2. В административной панели доступны разделы:
   - **Эксперты**: создание, редактирование, удаление экспертов.
   - **События**: управление чемпионатами и экзаменами.
   - **Студенты**: добавление, редактирование, удаление и экспорт данных.
   - **Данные студентов**: экспорт работ студентов.
   - **Модули**: управление этапами событий (добавление, очистка, смена статуса).
   - **Файлы**: загрузка, скачивание и удаление материалов.
3. Для выхода нажмите «Выход» в меню пользователя.

### Для администраторов

- Регулярно создавайте резервные копии базы данных и директорий `/events` и `/students`.
- Используйте команды для эксплуатации:
  - `php yii migrate` — применение миграций базы данных.
  - `php yii service/setup` — проверка, установка и настройка зависимостей.
  - `php yii service/clear` — удаление неактивных пользователей и связанных данных.

## Логи и очереди

- **Логи**:

  - Логи Yii2: `frontend/runtime/logs`, `backend/runtime/logs`, `console/runtime/logs`.
  - Логи bash-скриптов: `bash/logs`.

- **Очереди**:

  - Просмотр работы очередей: используйте журнал Linux для сервиса `redis`:

    ```bash
    sudo journalctl -u redis
    ```

  - Для кастомных очередей Yii2: используйте журнал Linux для сервиса `yii-queue-worker.service`:

    ```bash
    sudo journalctl -u yii-queue-worker.service -f
    ```

## Сообщение об ошибках

Если вы обнаружили баг, создайте Issue с описанием:

- Шаги воспроизведения.
- Ожидаемое и фактическое поведение.
- Системные характеристики (ОС, версии ПО).

## Лицензия

Проект распространяется под лицензией MIT. Вы можете свободно использовать, модифицировать и распространять код при условии указания авторства и сохранения лицензии.

## Контакты

Для вопросов и предложений:

- **Автор**: Даниил Вадимович Семенов
- **Электронная почта**: ds.daniilsemen.ds@gmail.com
- **GitHub**: https://github.com/Semenov-Daniil

---

*Проект разработан в рамках дипломной работы Санкт-Петербургского колледжа судостроения, информационных и прикладных технологий, 2025 год.*

```
