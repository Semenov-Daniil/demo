# README для Bash-скриптов проекта

## Оглавление
- [Общее описание](#общее-описание)
- [Структура папок](#структура-папок)
- [Глобальный конфигурационный файл](#глобальный-конфигурационный-файл)
- [Скрипты](#скрипты)
  - [Папка `lib/`](#папка-lib)
  - [Папка `logging/`](#папка-logging)
  - [Папка `chroot/`](#папка-chroot)
  - [Папка `samba/`](#папка-samba)
  - [Папка `ssh/`](#папка-ssh)
  - [Папка `setup/`](#папка-setup)
  - [Папка `system/`](#папка-system)
  - [Папка `utils/`](#папка-utils)
  - [Папка `vhost/`](#папка-vhost)

## Общее описание
Этот документ описывает Bash-скрипты, используемые для настройки и управления проектом. Скрипты расположены в папке `bash` в корне проекта и предназначены для автоматизации задач, таких как настройка Samba, SSH, виртуальных хостов, системной логики и утилит.

## Структура папок
- **`bash/`** — корневая папка для всех скриптов.
  - **`config.sh`** — глобальный конфигурационный файл, подключаемый ко всем скриптам.
  - **`lib/`** — подключаемые файлы с общими функциями.
  - **`logging/`** — скрипты логирования.
  - **`chroot/`** — скрипты для настройки chroot.
  - **`samba/`** — скрипты для настройки Samba.
  - **`ssh/`** — скрипты для настройки SSH.
  - **`setup/`** — скрипты для настройки проекта.
  - **`system/`** — скрипты для системной логики.
  - **`utils/`** — утилиты, которые можно запускать самостоятельно.
  - **`vhost/`** — скрипты для настройки виртуальных хостов.
  - **`logs/`** — папка для хранения логов (создаётся автоматически).
  - **`tmp/`** — папка для хранения вмременных файлов (создаётся автоматически).

Каждая из папок `logging`, `setup`, `samba`, `ssh`, `system`, `utils`, `vhost` содержит локальный файл `config.sh` с настройками, специфичными для данной категории скриптов.

## Глобальный конфигурационный файл
Файл `bash/config.sh` задаёт основные переменные и функции, используемые всеми скриптами, проверяет основные показатели. Он должен быть подключён (`source`) в начале каждого скрипта.

### Переменные
Получается переменные из `.env` файла проекта. 
Основные переменные, которые можно настроить:
- Переменные студентов:
  - **`STUDENT_GROUP`** (по умолчанию: `students`) — группа для студентов.
  - **`STUDENTS_DIR`** (по умолчанию: `${PROJECT_ROOT}/students`) — директория для данных студентов.
- Переменные логирования:
  - **`DEFAULT_LOG_FILE`** (по умолчанию: `logs.log`) - название файла логирования.
- Сервисы и пакеты:
  - **`REQUIRED_SERVICES`** — массив сервисов, необходимых для работы.
  - **`REQUIRED_SERVICE_MAP`** — массив пакетов сервисов, необходимых для работы.
- Переменные блоуировки flock:
  - **`LOCK_TIMEOUT`** (по умолчанию: `30`) - время блокировки фалов (в секундах).
  - **`LOCK_PREF`** (по умолчанию: `lock`) - превикс файлов блокировки.
- Переменные chroot:
  - **`BASE_CHROOT`** (по умолчанию `/srv/chroot`) - путь к chroot.

## Скрипты

### Папка `lib/`
Содержит подключаемые файлы с функциями, используемыми другими скриптами.

#### check_commands.fn.sh
**Описание**: Проверяет наличие указанных команд в системе.

**Функции**:
- `check_commands <команда1> <команда2> ...` — возвращает 0, если все команды доступны, или 1, если есть отсутствующие.

#### check_dependency.fn.sh
**Описание**: Проверяет наличие указанных пакетов в системе через `dpkg-query`.

**Функции**:
- `check_dependency <пакет1> <пакет2> ...` — возвращает 0, если все пакеты установлены, или 1, если есть отсутствующие.

#### common.sh
**Описание**: Подключает вспомогательные скрипты из директории `lib`.

**Функциональность**:
- Подключает `check_commands.fn.sh`, `check_dependency.fn.sh`, `create_directories.fn.sh`, `update_permissions.fn.sh`, `with_lock.fn.sh`.

#### create_directories.fn.sh
**Описание**: Создаёт директории, устанавливает права и владельцев.

**Функции**:
- `create_directories <путь1> <путь2> ... <права> <владелец>` — создаёт директории с указанными правами (восьмеричный формат) и владельцем (формат `user:group`). Возвращает 0 при успехе, 1 при ошибке.

#### mounts.fn.sh
**Описание**: Предоставляет функции для монтирования файловых систем и управления systemd mount units.

**Функции**:
- `title_mount_unit <путь>` — генерирует название systemd mount unit.
- `path_to_unit <название>` — возвращает путь к файлу unit.
- `is_active_unit <название>` — проверяет, активен ли unit.
- `create_systemd_unit <название> <содержимое>` — создаёт systemd unit.
- `start_systemd_unit <название>` — запускает systemd unit.
- `remove_systemd_unit <название>` — удаляет systemd unit.
- `get_unit_content <источник> <назначение> [<тип>] [<опции>] [<зависимости>]` — генерирует содержимое mount unit.
- `mount_unit <источник> <назначение> [<тип>] [<опции>] [<зависимости>]` — монтирует файловую систему.
- `mount_bind <источник> <назначение> [<опции>] [<зависимости>]` — выполняет bind-монтирование.
- `mount_rbind <источник> <назначение> [<опции>] [<зависимости>]` — выполняет rbind-монтирование.
- `mount_devtmpfs <назначение> [<зависимости>]` — монтирует devtmpfs.
- `mount_devpts <назначение> [<зависимости>]` — монтирует devpts.
- `mount_tmpfs <назначение> [<опции>] [<зависимости>]` — монтирует tmpfs.
- `mount_proc <назначение> [<зависимости>]` — монтирует proc.
- `mount_overlay <lowerdir> <upperdir> <workdir> <merged> [<зависимости>]` — монтирует overlay.
- `mount_rslave <цель> <зависимости>` — выполняет rslave-монтирование.
- `get_mount_units <директория>` — возвращает список mount units в директории.
- `umount_unit <цель>` — размонтирует файловую систему.

**Переменные**:
- `MOUNT_UNIT_DIR` (по умолчанию: `/etc/systemd/system`) — директория для systemd units.
- `LOCK_SYSTEMD_FILE` (по умолчанию: `/tmp/lock_systemd_unit.lock`) — файл блокировки.
- `UNIT_START_TIMEOUT` (по умолчанию: `15`) — таймаут запуска unit (в секундах).

#### restrict_binaries.fn.sh
**Описание**: Ограничивает доступ к указанным бинарным файлам в chroot-окружении.

**Функции**:
- `restrict_binaries <корень> <команда1> <команда2> ...` — устанавливает права `000` для указанных команд в `/bin` или `/usr/bin` chroot-окружения. Возвращает 0 при успехе, 1 при ошибке.

#### update_permissions.fn.sh
**Описание**: Обновляет права и владельцев для файлов и директорий.

**Функции**:
- `update_permissions <путь1> <путь2> ... <права> <владелец>` — устанавливает права (восьмеричный формат) и владельца (формат `user:group`). Возвращает 0 при успехе, 1 при ошибке.

#### with_lock.fn.sh

**Описание**: Выполняет операции с использованием блокировки через `flock`.

**Функции**:
- `with_lock <файл_блокировки> <действие> [<аргументы> ...]` — выполняет указанное действие с блокировкой. Возвращает 0 при успехе, 1 при ошибке.

### Папка `logging/`
Содержит скрипты для логирования сообщений и управления лог-файлами. Скрипты предназначены для записи сообщений в файлы, вывода в консоль и очистки устаревших логов.

#### Локальный `config.sh`

**Описание**: Задаёт конфигурацию для скриптов логирования.

**Переменные**:
- `LOG_RETENTION_DAYS` (по умолчанию: `30`) — срок хранения логов (в днях).
- `LOCK_LOG_PREF` (по умолчанию: `lock_log`) — префикс для файлов блокировки.
- `LOG_LEVELS` (по умолчанию: `info`, `warning`, `error`, `ok`) — допустимые уровни логов.

#### clean_logs.sh
**Описание**: Очищает записи в лог-файлах, старше указанного срока хранения.

**Функции**:
- `clean_logs` — очищает все лог-файлы в директории `LOGDIR`, удаляя записи старше `LOG_RETENTION_DAYS`.
- `clean_log <файл> <дата>` — очищает записи в указанном файле, старше заданной даты.

#### logging.fn.sh
**Описание**: Предоставляет функции для логирования сообщений в файлы и вывода в консоль.

**Функции**:
- `log_message <уровень> <сообщение>` — записывает сообщение в лог-файл и выводит в консоль. Уровни: `info`, `warning`, `error`, `ok`.
- `check_level <уровень>` — проверяет допустимость уровня лога.
- `make_log_dir <путь_к_лог_файлу>` — создаёт директорию для логов.
- `write_log <файл> <запись>` — записывает сообщение в лог-файл.
- `print_log <уровень> <сообщение>` — выводит сообщение в консоль.
- `format_log <уровень> <сообщение>` — форматирует запись лога с временной меткой.

### Папка `chroot/`
Cодержит скрипты для создания, настройки, управления и удаления chroot-окружений, включая рабочие пространства пользователей. Скрипты используют функции из bash/lib для монтирования, ограничения доступа и логирования.

#### Локальный `config.sh`
**Описание**: Задаёт конфигурацию для скриптов chroot-окружения.

**Переменные**:
- `SYSTEM_DIRS` — системные директории для монтирования.
- `RESTRICTED_CMDS` — команды, ограничиваемые в chroot.
- `LOCK_CHROOT_PREF` (`lock_chroot`) — префикс для файлов блокировки.
- `ETC_BASHRC`, `ETC_BASH_PREEXEC` — пути к конфигурационным файлам Bash.
- `MOUNTS_FN`, `RESTRICT_BINARIES_FN`, `SETUP_CHROOT`, `INIT_CHROOT`, `REMOVE_CHROOT`, `REMOVE_WORKSPACE` — пути к скриптам и функциям.

#### init_chroot.sh
**Описание**: Инициализирует chroot-окружение с монтированием системных директорий.

**Функции**:
- `init_chroot` — создаёт chroot-окружение в `BASE_CHROOT`, монтирует системные директории, ограничивает команды.

**Использование**:
```bash
sudo bash /path/to/init_chroot.sh || exit $?
```

#### remove_chroot.sh
**Описание**: Удаляет chroot-окружение.

**Функции**:
- `remove_chroot` — размонтирует и удаляет директорию `BASE_CHROOT`.

**Использование**:
```bash
sudo bash /path/to/remove_chroot.sh || exit $?
```

#### remove_workspace.sh
**Описание**: Удаляет рабочее пространство пользователя в chroot.

**Функции**:
- `remove_chroot_workspace <имя_пользователя>` — размонтирует и удаляет рабочее пространство пользователя.

**Использование**:
```bash
sudo bash /path/to/remove_workspace.sh || exit $?
```

#### setup_chroot.sh
**Описание**: Настраивает chroot-окружение, включая файлы Bash и ограничения.

**Функции**:
- `check_bashrc` — обновляет `.bashrc` в chroot.
- `check_bash_preexec` — обновляет `.bash-preexec.sh` в chroot.
- `check_chroot` — проверяет существование chroot и инициализирует при необходимости.

**Использование**:
```bash
sudo bash /path/to/setup_chroot.sh || exit $?
```

#### setup_workspace.sh
**Описание**: Создаёт рабочее пространство пользователя в chroot.

**Функции**:
- `setup_user_workspace <имя_пользователя> <рабочая_директория>` — создаёт рабочее пространство, монтирует директорию, настраивает `.bashrc` и `.bash-preexec.sh`.

**Использование**:
```bash
sudo bash /path/to/setup_workspace.sh username /path/to/workspace || exit $?
```

#### Конфигурационные файлы

#### .bashrc
**Описание**: Конфигурация Bash для пользователей в chroot-окружении. Задаёт переменные окружения, ограничения ресурсов, логирование команд и проверку путей.

#### .bash-preexec.sh
**Описание**: Поддержка функций `preexec` и `precmd` для выполнения проверок перед командами и отображением приглашения в chroot.

### Папка `/samba`
Содержит скрипты для настройки Samba, управления пользователями и конфигурацией сетевых шар. Скрипты используют функции из `bash/lib` для проверки зависимостей, монтирования и логирования.

#### Локальный `config.sh`
**Описание**: Задаёт конфигурацию для скриптов Samba.

**Переменные**:
- `LOCK_SAMBA_PREF` (`lock_samba`) — префикс для файлов блокировки.
- `CONFIG_SAMBA`, `REMOVE_USER` — пути к скриптам Samba.

#### add_samba_user.sh
**Описание**: Добавляет или обновляет пользователя Samba.

**Функции**:
- `add_samba_user <имя_пользователя> <пароль>` — добавляет пользователя Samba или обновляет его пароль.

**Использование**:
```bash
sudo bash /path/to/add_samba_user.sh username password || exit $?
```

#### check_setup_samba.sh
**Описание**: Проверяет и настраивает зависимости, сервисы и порты Samba.

**Функции**:
- `start_samba_services` — запускает сервисы `smbd` и `nmbd`.
- `configure_ufw` — открывает порты Samba в UFW.
- `check_samba_dependencies` — проверяет наличие пакетов и команд Samba.

**Переменные**:
- `SAMBA_PORTS` (`137/udp`, `138/udp`, `139/tcp`, `445/tcp`) — порты Samba.
- `SAMBA_REQUIRED_COMMAND` (`pdbedit`, `smbpasswd`, `smbcontrol`, `testparm`) — необходимые команды.
- `SAMBA_REQUIRED_DEPENCY` (`samba`, `samba-common-bin`) — необходимые пакеты.
- `SAMBA_SERVICES` (`smbd`, `nmbd`) — сервисы Samba.
- `SERVICE_START_TIMEOUT` (5) — таймаут запуска сервиса (в секундах).

**Использование**:
```bash
sudo bash /path/to/check_setup_samba.sh || exit $?
```

#### remove_samba_user.sh
**Описание**: Удаляет пользователя Samba и завершает его сессии.

**Функции**:
- `get_user_pids <имя_пользователя>` — получает PID активных сессий.
- `close_samba_sessions <имя_пользователя>` — завершает сессии пользователя.
- `remove_samba_user <имя_пользователя>` — удаляет пользователя Samba.

**Использование**:
```bash
sudo bash /path/to/remove_samba_user.sh username || exit $?
```

#### config_samba.sh
**Описание**: Настраивает конфигурацию Samba, включая `smb.conf` и `student.conf`.

**Функции**:
- `check_requirements` — проверяет наличие Samba и файлов конфигурации.
- `restart_smbd` — перезапускает сервис `smbd`.
- `check_global_section` — добавляет включение `student.conf` в `smb.conf`.
- `check_student_template` — обновляет `student.conf`.
- `apply_updates` — применяет изменения конфигурации.

**Переменные**:
- `CONFIG_FILE` (`/etc/samba/smb.conf`) — основной файл конфигурации Samba.
- `STUDENT_CONF` (`/etc/samba/student.conf`) — файл конфигурации для студентов.
- `TEMPLATE_CONF` (`student.conf`) — шаблон конфигурации.
- `LOCK_FILE` (`/tmp/samba_configure.lock`) — файл блокировки.
- `BACKUP_DIR` (`/etc/samba/backup`) — директория для резервных копий.

**Использование**:
```bash
sudo bash /path/to/config_samba.sh || exit $?
```

#### Конфигурационные файлы

#### student.conf
**Описание**: Шаблон конфигурации Samba для создания пользовательских сетевых шар с доступом к рабочим пространствам.

### Папка `/setup`
Содержит скрипты для базовой настройки проекта, включая проверку и запуск сервисов, настройку cron-заданий и управление очередями Yii2.

#### Локальный `config.sh`
**Описание**: Задаёт конфигурацию для скриптов настройки.

#### check_services.sh
**Описание**: Проверяет и устанавливает пакеты, запускает сервисы, указанные в `REQUIRED_SERVICES` и `REQUIRED_SERVICE_MAP`. Поддерживает флаг `-y` для автоматического подтверждения.

**Функции**:
- `install_package <пакет>` — устанавливает пакет, если он отсутствует.
- `start_service <сервис>` — включает и запускает сервис.

**Использование**:
```bash
sudo bash /path/to/check_services.sh -y || exit $?
```

#### setup_cron.sh
**Описание**: Настраивает cron-задания для запуска скриптов проекта.

**Функции**:
- `start_cron_services` — запускает сервис `cron`.
- `setup_cron_jobs` — добавляет задания в crontab.

**Переменные**:
- `CRON_JOBS` — ассоциативный массив с путями к скриптам и расписанием (например, `CHECK_SERVICES` — `0 0 * * *`).
- `SERVICE_START_TIMEOUT` — таймаут запуска сервиса (в секундах, определяется внешне).

**Использование**:
```bash
sudo bash /path/to/setup_cron.sh || exit $?
```

#### setup_queue.sh
**Описание**: Настраивает и запускает systemd unit для очереди Yii2.

**Использование**:
```bash
sudo bash /path/to/setup_queue.sh || exit $?
```

#### setup.sh
**Описание**: Выполняет полную настройку проекта, запуская скрипты из директорий `setup`, `chroot`, `samba`, `ssh`, `vhost`, `logging`.

**Использование**:
```bash
sudo bash /path/to/setup.sh || exit $?
```

### Папка `/ssh`
Содержит скрипты для настройки SSH-сервера, включая запуск сервисов, конфигурацию портов и файлов конфигурации.

#### Локальный `config.sh`
**Описание**: Задаёт конфигурацию для скриптов SSH.

**Переменные**:
- `CONFIG_FILE` (`/etc/ssh/sshd_config`) — основной файл конфигурации SSH.
- `CONFIG_DIR` (`/etc/ssh/sshd_config.d`) — директория дополнительных конфигураций.

#### check_setup_ssh.sh
**Описание**: Проверяет и настраивает сервисы SSH, порты и зависимости.

**Функции**:
- `start_ssh_services` — запускает сервисы из `SSH_SERVICES`.
- `get_ssh_port` — получает порт SSH из конфигурации.
- `configure_ufw` — открывает порт SSH в UFW.
- `check_samba_dependencies` — проверяет наличие пакета `openssh-server` и команды `sshd`.

**Использование**:
```bash
sudo bash /path/to/check_setup_ssh.sh || exit $?
```

#### config_ssh.sh
**Описание**: Настраивает конфигурацию SSH, включая `sshd_config` и `student.conf`.

**Функции**:
- `check_requirements` — проверяет наличие SSH и файлов конфигурации.
- `restart_ssh` — перезапускает сервис `sshd`.
- `check_main_config` — добавляет включение `student.conf` в `sshd_config`.
- `check_student_template` — обновляет `student.conf`.
- `apply_updates` — применяет изменения конфигурации.

**Переменные**:
- `LOCK_FILE` (`/tmp/ssh_configure.lock`) — файл блокировки.
- `BACKUP_DIR` (`/etc/ssh/backup`) — директория для резервных копий.

**Использование**:
```bash
sudo bash /path/to/config_ssh.sh || exit $?
```

#### Конфигурационные файлы

#### student.conf
**Описание**: Шаблон конфигурации SSH для пользователей группы `STUDENT_GROUP`, задающий chroot-окружение и ограничения.

### Папка `/system`
Содержит скрипты для создания и удаления системных пользователей, их интеграции с chroot и Samba.

#### config.sh
**Описание**: Задаёт конфигурацию для скриптов управления пользователями.

**Переменные**:
- `LOCK_USER_PREF` (`lock_user`) — префикс для файлов блокировки.
- `DELETE_USER`, `ADD_SAMBA_USER`, `REMOVE_SAMBA_USER`, `CONFIG_SSH`, `SETUP_WORKSPACE`, `REMOVE_WORKSPACE` — пути к скриптам проекта.

**Использование**:
```bash
source /path/to/config.sh
```

#### create_user.sh
**Описание**: Создаёт системного пользователя, его рабочую область в chroot и Samba-учётную запись. При ошибке удаляет созданного пользователя.

**Функции**:
- `create_user` — создаёт пользователя, устанавливает пароль и группу.

**Использование**:
```bash
sudo bash /path/to/create_user.sh username password /path/to/workspace || exit $?
```

#### delete_user.sh
**Описание**: Удаляет системного пользователя, его рабочую область в chroot и Samba-учётную запись.

**Функции**:
- `terminate_user <имя_пользователя>` — завершает процессы пользователя.
- `delete_user <имя_пользователя>` — удаляет пользователя и его домашнюю директорию.

**Использование**:
```bash
sudo bash /path/to/delete_user.sh username || exit $?
```

### Папка `/utils`
Содержит утилитные скрипты для создания директорий, управления правами и монтирования/размонтирования файловых систем для использования внутри php.

#### Локальный `config.sh`
**Описание**: Задаёт конфигурацию для утилитных скриптов. Не определяет собственных переменных, подключает глобальный `config.sh`.

#### create_directories.sh
**Описание**: Создаёт директории с указанными правами и владельцем, используя функцию `create_directories` из `bash/lib`.

**Использование**:
```bash
sudo bash /path/to/create_directories.sh /path/dir1 /path/dir2 755 root:root || exit $?
```

#### mount.sh
**Описание**: Выполняет bind-монтирование файловой системы, используя функцию `mount_bind` из `bash/lib`.

**Использование**:
```bash
sudo bash /path/to/mount.sh /source /dest [options] || exit $?
```

#### umount.sh
**Описание**: Размонтирует файловую систему, используя функцию `umount_unit` из `bash/lib`.

**Использование**:
```bash
sudo bash /path/to/umount.sh /target || exit $?
```

#### update_permissions.sh
**Описание**: Обновляет права и владельца для файлов/директорий, используя функцию `update_permissions` из `bash/lib`.

**Использование**:
```bash
sudo bash /path/to/update_permissions.sh /path/file1 /path/dir1 755 root:root || exit $?
```

### Папка `/vhost`
Содержит скрипты для настройки Apache, управления виртуальными хостами, их создания, включения, отключения и удаления.

#### Локальный `config.sh`
**Описание**: Задаёт конфигурацию для скриптов управления виртуальными хостами Apache.

**Переменные**:
- `VHOST_AVAILABLE` (`/etc/apache2/sites-available`) — директория доступных хостов.
- `VHOST_ENABLED` (`/etc/apache2/sites-enabled`) — директория включённых хостов.
- `LOCK_VHOST_PREF` (`lock_vhost`) — префикс для файлов блокировки хоста.
- `LOCK_GLOBAL_VHOST` (`lock_vhost_global`) — файл глобальной блокировки.

#### check_setup_apache.sh
**Описание**: Проверяет и настраивает сервисы Apache, порты и зависимости.

**Функции**:
- `start_apache_service` — запускает сервисы из `APACHE_SERVICES`.
- `configure_ufw` — открывает порты Apache в UFW.
- `check_apache_dependencies` — проверяет наличие пакета `apache2` и команд.

**Переменные**:
- `APACHE_SERVICES` (`apache2`) — сервисы Apache.
- `APACHE_COMMAND` (`a2ensite`, `a2dissite`, `apache2ctl`) — команды Apache.
- `APACHE_PORTS` (`80/tcp`, `443/tcp`) — порты Apache.
- `SERVICE_START_TIMEOUT` (5) — таймаут запуска сервиса (в секундах).

**Использование**:
```bash
sudo bash /path/to/check_setup_apache.sh || exit $?
```

#### setup_apache.sh
**Описание**: Настраивает Apache, включая модуль `mpm_itk` и его параметры.

**Функции**:
- `check_requirements` — проверяет наличие Apache и конфигурации.
- `check_mpm_itk` — устанавливает и настраивает модуль `mpm_itk`.
- `restart_apache` — перезапускает сервис Apache.
- `setup_apache` — выполняет настройку Apache с блокировкой.

**Переменные**:
- `MAIN_CONFIG` (`/etc/apache2/apache2.conf`) — основной файл конфигурации.
- `BACKUP_FILE` — путь к резервной копии конфигурации.

**Использование**:
```bash
sudo bash /path/to/setup_apache.sh || exit $?
```

#### create_vhost.sh
**Описание**: Создаёт и включает виртуальный хост Apache на основе шаблона `vhost.conf`.

**Функции**:
- `setup_vhost <пользователь> <домен> <директория>` — настраивает виртуальный хост.
- `create_vhost <файл> <пользователь> <домен> <директория>` — создаёт файл конфигурации.
- `configtest <домен> <файл>` — проверяет синтаксис конфигурации.

**Использование**:
```bash
sudo bash /path/to/create_vhost.sh username domain /path/to/dir || exit $?
```

#### enable_vhost.sh
**Описание**: Включает виртуальный хост Apache.

**Функции**:
- `enable_vhost <домен>` — включает хост с помощью `a2ensite`.
- `_enable_vhost_lock <домен>` — выполняет включение с блокировкой.
- `_reload_apache_lock <домен>` — перезагружает Apache.
- `_disable_vhost_lock <домен>` — отключает хост при ошибке.

**Использование**:
```bash
sudo bash /path/to/enable_vhost.sh domain || exit $?
```

#### disable_vhost.sh
**Описание**: Отключает виртуальный хост Apache.

**Функции**:
- `disable_vhost <домен>` — отключает хост с помощью `a2dissite`.
- `_disable_vhost_lock <домен>` — выполняет отключение с блокировкой.
- `_reload_apache_lock <домен>` — перезагружает Apache.
- `_enable_vhost_lock <домен>` — включает хост при ошибке.

**Использование**:
```bash
sudo bash /path/to/disable_vhost.sh domain || exit $?
```

#### remove_vhost.sh
**Описание**: Удаляет виртуальный хост Apache.

**Функции**:
- `remove_vhost <домен>` — отключает и удаляет файл конфигурации хоста.

**Использование**:
```bash
sudo bash /path/to/remove_vhost.sh domain || exit $?
```

#### Конфигурационные файлы

#### vhost.conf
**Описание**: Шаблон конфигурации виртуального хоста Apache для настройки домена, директории и прав доступа.